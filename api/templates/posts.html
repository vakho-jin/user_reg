{% extends 'base.html' %}
{% block title %}პოსტები{% endblock %}
{% block content %}
    <h1>პოსტები</h1>
    <form id="post-form">
        <label for="title">სათაური:</label>
        <input type="text" id="title" name="title" required>
        <label for="content">კონტენტი:</label>
        <textarea id="content" name="content" required></textarea>
        <button type="submit">პოსტის შექმნა</button>
    </form>
    <div id="posts-list"></div>
    <script>
        async function fetchPosts() {
            const token = localStorage.getItem('token');
            const response = await fetch('/api/posts/', {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            const posts = await response.json();
            const postsList = document.getElementById('posts-list');
            postsList.innerHTML = '';
            posts.forEach(post => {
                const div = document.createElement('div');
                div.className = 'post';
                div.innerHTML = `
                    <h3>${post.title}</h3>
                    <p>${post.content}</p>
                    <p>By ${post.author} on ${new Date(post.created_at).toLocaleDateString()}</p>
                    <button onclick="deletePost(${post.id})">წაშლა</button>
                `;
                postsList.appendChild(div);
            });
        }

        document.getElementById('post-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const title = document.getElementById('title').value;
            const content = document.getElementById('content').value;
            const token = localStorage.getItem('token');
            await fetch('/api/posts/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({ title, content })
            });
            document.getElementById('post-form').reset();
            fetchPosts();
        });

        async function deletePost(id) {
            const token = localStorage.getItem('token');
            await fetch(`/api/posts/${id}/`, {
                method: 'DELETE',
                headers: { 'Authorization': `Bearer ${token}` }
            });
            fetchPosts();
        }

        fetchPosts();
    </script>
{% endblock %}